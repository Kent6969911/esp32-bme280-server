<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BME280 Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    font-family: Arial;
    background: #f4f4f4;
    margin: 0;
    padding: 15px;
  }
  h1 { text-align: center; }

  .logout {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 8px;
  }

  .container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    cursor: pointer;
  }

  .active { border: 3px solid #007BFF; }
  .high-temp { background: #ffcccc; }

  .icon { font-size: 40px; }
  .value { font-size: 26px; font-weight: bold; }

  @media (min-width: 768px) {
    .container { grid-template-columns: repeat(3, 1fr); }
  }
</style>
</head>

<body>

<button class="logout" onclick="logout()">Logout</button>

<h1>üåç ESP32 BME280 Dashboard</h1>

<div class="container">
  <div class="card" onclick="select('temperature', this)">
    <div class="icon">üå°</div>
    <h3>Temperature</h3>
    <div class="value"><span id="temp">--</span> ¬∞C</div>
  </div>

  <div class="card" onclick="select('humidity', this)">
    <div class="icon">üíß</div>
    <h3>Humidity</h3>
    <div class="value"><span id="hum">--</span> %</div>
  </div>

  <div class="card" onclick="select('pressure', this)">
    <div class="icon">‚è≤</div>
    <h3>Pressure</h3>
    <div class="value"><span id="pres">--</span> hPa</div>
  </div>
</div>

<canvas id="chart" height="120"></canvas>

<script>
/* üîê LOGIN CHECK ‚Äî NAKA-INTEGRATE NA */
if (localStorage.getItem("loggedIn") !== "true") {
  window.location.href = "login.html";
}

/* üîß CONFIG */
const url = "https://esp32-bme280.onrender.com/data"; // PALITAN KUNG IBA SA'YO

let current = "temperature";
let history = { temperature: [], humidity: [], pressure: [] };

const chart = new Chart(document.getElementById("chart"), {
  type: "line",
  data: { labels: [], datasets: [{ data: [], borderWidth: 2 }] }
});

function select(sensor, card) {
  current = sensor;
  document.querySelectorAll(".card").forEach(c => c.classList.remove("active"));
  card.classList.add("active");
  updateChart();
}

function updateChart() {
  chart.data.labels = history[current].map((_, i) => i + 1);
  chart.data.datasets[0].data = history[current];
  chart.data.datasets[0].label = current.toUpperCase();
  chart.update();
}

function logout() {
  localStorage.removeItem("loggedIn");
  window.location.href = "login.html";
}

setInterval(() => {
  fetch(url).then(r => r.json()).then(d => {
    temp.innerText = d.temperature.toFixed(1);
    hum.innerText = d.humidity.toFixed(1);
    pres.innerText = d.pressure.toFixed(1);

    history.temperature.push(d.temperature);
    history.humidity.push(d.humidity);
    history.pressure.push(d.pressure);

    if (history.temperature.length > 20) {
      history.temperature.shift();
      history.humidity.shift();
      history.pressure.shift();
    }

    updateChart();

    if (d.temperature > 35) {
      document.querySelector(".card").classList.add("high-temp");
    }
  });
}, 3000);
</script>

</body>
</html>
